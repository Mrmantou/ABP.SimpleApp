#### 创建People展示页面

到目前为止Person实体中只包含了Name一个描述属性，这里先给Person实体添加几个属性：
```csharp
[Table("AppPersons")]
public class Person : AuditedEntity<Guid>
{
    [Required]
    [StringLength(SimpleTaskAppConsts.MaxNameLength)]
    public string Name { get; set; }

    [StringLength(SimpleTaskAppConsts.MaxPhoneNumberLength)]
    public string PhoneNumber { get; set; }

    public int? Age { get; set; }

    public char? Gender { get; set; }

    [EmailAddress]
    public string Email { get; set; }

    [StringLength(SimpleTaskAppConsts.MaxAddressLength)]
    public string Address { get; set; }

    public Person() { }

    public Person(string name)
    {
        Name = name;
    }
}
```
接下来迁移变化到数据库：
```
PM> add-migration "add_Person_proterty"
To undo this action, use Remove-Migration.
PM> update-database
```
查看数据库可以看到数据库添加了新的字段：

![Databaseresult2](../image/databaseresult2.png)

#### 应用层查询所有的People信息

在应用服务层中`PersonAppService`中添加查询所有peoson信息的接口及方法：
```csharp
public interface IPersonAppService
{
    //...
    Task<ListResultDto<PersonListDto>> GetAl(GetAllPeopleInput input);
}

public class PersonAppService : SimpleTaskAppAppServiceBase, IPersonAppService
{
    //...
    public async Task<ListResultDto<PersonListDto>> GetAll(GetAllPeopleInput input)
    {
        var people = await repository.GetAll()
              .WhereIf(!string.IsNullOrEmpty(input.Name), p => p.Name == input.Name)
              .OrderBy(p => p.Name)
              .ToListAsync();

        return new ListResultDto<PersonListDto>(ObjectMapper.Map<List<PersonListDto>>(people));
    }
}
```
其中的入参和返回参数分别为：
```csharp
public class GetAllPeopleInput
{
    public string Name { get; set; }
}

[AutoMapFrom(typeof(Person))]
public class PersonListDto
{
    public string Name { get; set; }

    public string PhoneNumber { get; set; }

    public int? Age { get; set; }

    public char? Gender { get; set; }

    public string Email { get; set; }

    public string Address { get; set; }
}
```

#### 测试上面的查询方法

在.Tests项目中添加PeopleAppService的测试类，并添加两个方法从数据库中查询数据：
```csharp
public class PeopleAppService_Tests : SimpleTaskAppTestBase
{
    private readonly IPersonAppService personAppService;

    public PeopleAppService_Tests()
    {
        personAppService = Resolve<IPersonAppService>();
    }

    [Fact]
    public async Task Should_Get_All_People()
    {
        var output = await personAppService.GetAll(new GetAllPeopleInput());

        output.Items.Count.ShouldBe(2);
    }

    [Fact]
    public async Task Should_Get_Filtered_People()
    {
        var output = await personAppService.GetAll(new GetAllPeopleInput() { Name="Athy" });

        output.Items.Count.ShouldBe(1);
        output.Items.ShouldAllBe(p => p.Name == "Athy");
    }
}
```
这里为了测试效果在初始数据中又添加了一条person数据Athy：
```csharp
public void Build()
{
    //create test data here...
    var neo = new Person("Neo");
    var athy = new Person("Athy");
    _context.People.Add(neo);
    _context.People.Add(athy);
    //...
}
```
运行单元测试全部通过。

![Testperson](../image/testperson.png)

#### 添加Person控制器

创建控制器`PeopleController`:
```csharp
public class PeopleController : SimpleTaskAppControllerBase
{
    private readonly IPersonAppService personAppService;

    public PeopleController(IPersonAppService personAppService)
    {
        this.personAppService = personAppService;
    }

    public async Task<IActionResult> Index(GetAllPeopleInput input)
    {
        var output = await personAppService.GetAll(input);

        var model = new PeopleIndexViewModel(output.Items);

        return View(model);
    }
}
```
其中`PeopleIndexViewModel`为：
```csharp
public class PeopleIndexViewModel
{
    public IReadOnlyList<PersonListDto> People { get;set; }

    public PeopleIndexViewMode(IReadOnlyList<PersonListDto> people)
    {
        People = people;
    }
}
```

#### 创建People视图

添加Index视图:
```html
@model Albert.SimpleTaskApp.Web.Models.People.PeopleIndexViewModel

@{
    ViewData["Title"] = "Index";
}

<h2>@L("People")</h2>

<div class="row">
    <div>
        <ul class="list-group" id="People">
            @foreach (var person in Model.People)
            {
                <li class="list-group-item">
                    <h4 class="list-group-item-heading">@person.Name</h4>
                    <div class="list-group-item-text">
                        Age: @person.Age | Gender:<span class="@Model.GetPersonGender(person.Gender)" /> | Tel: @person.PhoneNumber | Email: @person.Email | Address: @person.Address
                    </div>
                </li>
            }
        </ul>
    </div>
</div>
```
在首页添加People导航，在SimpleTaskAppNavigationProvider中添加：
```csharp
public override void SetNavigation(INavigationProviderContext context)
{
    context.Manager.MainMenu
        //...
        ).AddItem(
            new MenuItemDefinition(
                PageNames.People,
                L("People"),
                url: "people",
                icon: "fa fa-users")
        );
}
```
添加页面名称：
```csharp
public class PageNames
{
    //...
    public const string People = "People";
}
```
本地化添加配置：
```json
"People": "People"
```
在数据库People表中存入一条数据，启动:

![Peoplepage](../image/peoplepage.png)

可以看见person信息已经全部展示在页面上。

#### 创建Person保存到数据库

首先在应用服务层添加创建实体的服务接口及方法：
```csharp
public interface IPersonAppService
{
    //...
    Task Create(CreatePersonInput input);
}

public class PersonAppService : SimpleTaskAppAppServiceBase, IPersonAppService
{
    //...
    public async Task Create(CreatePersonInput input)
    {
        var person = ObjectMapper.Map<Person>(input);

        await repository.InsertAsync(person);
    }
}
```

这里的CreatePersonInput页面传进的参数：
```csharp
[AutoMapTo(typeof(Person))]
public class CreatePersonInput
{
    [Required]
    [StringLength(SimpleTaskAppConsts.MaxNameLength)]
    public string Name { get; set; }

    [StringLength(SimpleTaskAppConsts.MaxPhoneNumberLength)]
    public string PhoneNumber { get; set; }

    public int? Age { get; set; }

    public Genter? Gender { get; set; }

    [EmailAddress]
    public string Email { get; set; }

    [StringLength(SimpleTaskAppConsts.MaxAddressLength)]
    public string Address { get; set; }
}
```

#### 单元测试应用服务层方法

编写单元测试：
```csharp
public class PeopleAppService_Tests : SimpleTaskAppTestBase
{
    //...
    [Fact]
    public async Task Should_Create_New_Person_With_Name()
    {
        await personAppService.Create(new CreatePersonInput
        {
            Name = "li"
        });

        UsingDbContext(context =>
        {
            var person1 = context.People.FirstOrDefault(p => p.Name == "li");
            person1.ShouldNotBeNull();
        });
    }

    [Fact]
    public async Task Should_Create_New_Person_Without_Name()
    {
        await Assert.ThrowsAsync<AbpValidationException>(async () =>
        {
            await personAppService.Create(new CreatePersonInput
            {
                Name = null
            });
        });
    }
}
```
上面两个测试方法通过CreatePersonInput对象传递person信息，由于Person->Name属性是必须的类型，所以在Name为Null的情形下抛出异常。运行单元测试通过。

![Testperson1](../image/testperson1.png)

#### 创建Person页面